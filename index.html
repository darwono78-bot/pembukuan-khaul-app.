[
  {
    "file_path": "index.html",
    "file_content": "<!DOCTYPE html>\n<html lang=\"id\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Pembukuan Haul: Donatur, Jurnal & Ekspor Lokal</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js\"></script>\n    \n    <style>\n        /* Gaya agar tabel bisa digeser jika terlalu lebar */\n        .table-wrapper {\n            overflow-x: auto; \n        }\n\n        /* --- PERBAIKAN FONT DAN TEBAL --- */\n        /* Ganti font global ke Cambria / Times New Roman / Serif */\n        body {\n            font-family: Cambria, 'Times New Roman', Times, serif; \n        }\n        \n        /* Ganti font size global untuk isi tabel agar tidak terlalu besar */\n        table {\n            font-size: 0.9rem; \n            width: 100%; \n        }\n\n        /* Hapus tebal default dari sel tabel (di JS, kita tambahkan lagi hanya pada total akhir) */\n        td {\n            font-weight: normal; \n        }\n\n        /* Class untuk Baris Total Akhir Jurnal dan Donatur agar TEBAL */\n        .total-row-bold td {\n            font-weight: bold !important;\n        }\n\n        /* --- PENYESUAIAN LEBAR KOLOM AGAR TIDAK DEMPET --- */\n        #jurnal-table th:nth-child(2), \n        #jurnal-table td:nth-child(2),\n        #donatur-table th:nth-child(2),\n        #donatur-table td:nth-child(2) {\n            /* Kolom Tanggal: Beri minimum lebar 110px */\n            min-width: 110px; \n        }\n\n        #jurnal-table th:nth-child(3),\n        #jurnal-table td:nth-child(3) {\n            /* Kolom Uraian (jika tidak login, ini akan jadi uraian+keterangan) */\n            min-width: 250px; \n        }\n        \n        #donatur-table th:nth-child(3),\n        #donatur-table td:nth-child(3) {\n            /* Kolom Nama Donatur */\n            min-width: 150px; \n        }\n\n        /* --- STICKY COLUMNS --- */\n        .sticky-col {\n            position: sticky;\n            left: 0;\n            z-index: 10;\n            border-right: 1px solid #e5e7eb; \n            min-width: 50px;\n        }\n        \n        .sticky-col-right {\n            position: sticky;\n            right: 0;\n            z-index: 10;\n            border-left: 1px solid #e5e7eb; \n            min-width: 120px;\n            background-color: #f3f4f6; \n        }\n        \n        .sticky-no-cell {\n            background-color: white !important; \n            font-weight: bold;\n        }\n        .sticky-action-cell {\n            background-color: #f3f4f6 !important; \n        }\n\n        /* Header Tabel */\n        .header-bg-donatur {\n            background-color: #6B46C1; \n            color: white;\n        }\n        .header-bg-jurnal {\n            background-color: #059669; \n            color: white;\n        }\n        \n        /* Gaya untuk Tombol Admin Kecil */\n        .btn-admin-small {\n            padding: 0.5rem 1rem; /* Padding lebih kecil */\n            font-size: 0.875rem; /* Text lebih kecil */\n        }\n        \n        /* Gaya untuk tombol pagination */\n        .pagination-btn {\n            padding: 0.5rem 1rem;\n            border-radius: 0.375rem; /* rounded-md */\n            font-weight: 700; /* font-bold */\n            transition: all 150ms;\n        }\n        .pagination-btn-active {\n            background-color: #FBBF24; /* bg-yellow-400 */\n            color: #1F2937; /* text-gray-800 */\n        }\n        .pagination-btn-inactive {\n            background-color: #E5E7EB; /* bg-gray-200 */\n            color: #4B5563; /* text-gray-600 */\n        }\n        .pagination-btn:not(.pagination-btn-active):hover {\n            background-color: #D1D5DB; /* hover:bg-gray-300 */\n        }\n    </style>\n</head>\n<body class=\"bg-gray-100 p-8\">\n\n    <div class=\"max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-xl\">\n        <h1 class=\"text-3xl font-bold text-center text-green-700 mb-4\">\n            Pembukuan Donatur Haul\n        </h1>\n        \n        <div class=\"flex flex-wrap gap-4 mb-8 justify-center border-b pb-4\">\n            <button onclick=\"exportDonaturPDF()\" class=\"py-2 px-4 bg-purple-600 text-white font-bold rounded hover:bg-purple-700 transition duration-150\">\n                Unduh PDF List Donatur\n            </button>\n            <button onclick=\"exportJurnalDetailPDF()\" class=\"py-2 px-4 bg-green-600 text-white font-bold rounded hover:bg-green-700 transition duration-150\">\n                Unduh PDF Laporan Detail Jurnal\n            </button>\n            <button onclick=\"exportLpjGlobalPDF()\" class=\"py-2 px-4 bg-yellow-600 text-white font-bold rounded hover:bg-yellow-700 transition duration-150\">\n                Unduh PDF Laporan Global (LPJ)\n            </button>\n        </div>\n\n        <hr class=\"my-8\">\n        \n        <h2 class=\"text-xl font-semibold mb-4 text-gray-700\">1. Jurnal Kas Umum (Dana Masuk & Keluar)</h2>\n        \n        <div class=\"table-wrapper mb-4\">\n            <table class=\"min-w-full divide-y divide-gray-200\" id=\"jurnal-table\">\n                <thead class=\"header-bg-jurnal\">\n                    <tr>\n                        <th class=\"sticky-col px-4 py-3 text-center text-xs font-medium uppercase tracking-wider\">NO</th>\n                        <th class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider\">Tanggal</th>\n                        <th id=\"th-jurnal-uraian\" class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider\">Uraian</th>\n                        <th id=\"th-jurnal-kategori\" class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden\">Kategori</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider bg-green-900\">Dana Masuk (Rp)</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider bg-red-900\">Dana Keluar (Rp)</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider\">Saldo (Rp)</th>\n                        <th id=\"th-jurnal-aksi\" class=\"sticky-col-right px-4 py-3 text-center text-xs font-medium uppercase tracking-wider hidden\">Aksi</th>\n                    </tr>\n                </thead>\n                <tbody id=\"jurnal-table-body\" class=\"bg-white divide-y divide-gray-200\">\n                    <tr><td colspan=\"8\" class=\"py-4 text-center text-gray-500\">Jurnal Kas Umum belum terisi.</td></tr>\n                </tbody>\n                <tfoot class=\"bg-gray-100 total-row-bold\"> \n                    <tr>\n                        <td id=\"td-jurnal-total-col\" colspan=\"3\" class=\"px-4 py-3 text-right text-sm bg-gray-200\">**TOTAL AKUMULASI KAS:**</td>\n                        <td id=\"td-jurnal-total-kategori\" class=\"px-4 py-3 text-right text-sm bg-gray-200 hidden\"></td>\n                        <td class=\"px-4 py-3 text-right text-sm text-green-700\" id=\"total-dana-masuk-jurnal\">Rp 0</td>\n                        <td class=\"px-4 py-3 text-right text-sm text-red-700\" id=\"total-dana-keluar-jurnal\">Rp 0</td>\n                        <td class=\"px-4 py-3 text-right text-sm bg-blue-100 text-blue-700\" id=\"saldo-akhir-jurnal\">Rp 0</td>\n                        <td id=\"td-jurnal-total-aksi\" class=\"sticky-col-right px-4 py-3 text-right text-sm bg-gray-200 hidden\"></td>\n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n        \n        <div id=\"jurnal-pagination-container\" class=\"flex justify-center gap-2 py-4 mb-12\">\n            </div>\n        \n        <hr class=\"my-8\">\n\n        <h2 class=\"text-xl font-semibold mb-4 text-gray-700\">2. Laporan List Donatur Jariyah</h2>\n        <p id=\"donatur-note-persentase\" class=\"mb-4 text-sm text-gray-600 hidden\">Total Jariyah akan dibagi secara otomatis: Perawatan Makam (15%), Ongkos Panitia (15%), Biaya Haul (70%).</p>\n        \n        <div class=\"table-wrapper mb-4\"> \n            <table class=\"min-w-full divide-y divide-gray-200\" id=\"donatur-table\">\n                <thead class=\"header-bg-donatur\">\n                    <tr>\n                        <th class=\"sticky-col px-4 py-3 text-center text-xs font-medium uppercase tracking-wider\" rowspan=\"2\">NO</th>\n                        <th class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider\" rowspan=\"2\">Tanggal</th>\n                        <th class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider\" rowspan=\"2\">Nama Donatur</th>\n                        <th class=\"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider\" rowspan=\"2\">Alamat</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider bg-purple-700\" rowspan=\"2\">Jariyah (Rp)</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider bg-green-700\" rowspan=\"2\">Total Jariyah (Rp)</th>\n                        <th id=\"th-donatur-presentase\" class=\"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider bg-yellow-700 hidden\" colspan=\"3\">Presentase Donasi</th>\n                        <th id=\"th-donatur-aksi\" class=\"sticky-col-right px-4 py-3 text-center text-xs font-medium uppercase tracking-wider hidden\" rowspan=\"2\">Aksi</th>\n                    </tr>\n                    <tr id=\"donatur-presentase-row\" class=\"bg-yellow-600 text-white hidden\">\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider\">Perawatan Makam (15%)</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider\">Ongkos Panitia (15%)</th>\n                        <th class=\"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider\">Biaya Haul (70%)</th>\n                    </tr>\n                </thead>\n                <tbody id=\"donatur-table-body\" class=\"bg-white divide-y divide-gray-200\">\n                    <tr><td colspan=\"10\" class=\"py-4 text-center text-gray-500\">Belum ada data donasi yang dicatat.</td></tr>\n                </tbody>\n                <tfoot class=\"bg-gray-200\">\n                    <tr id=\"total-akumulasi-row\" class=\"font-bold hidden\"> <td id=\"td-donatur-total-col-1\" colspan=\"6\" class=\"px-4 py-3 text-right text-sm bg-gray-300\">TOTAL AKUMULASI (Pembagian Presentase):</td>\n                        <td id=\"total-makam-footer\" class=\"px-4 py-3 text-right text-sm text-yellow-800 hidden\">Rp 0</td>\n                        <td id=\"total-panitia-footer\" class=\"px-4 py-3 text-right text-sm text-yellow-800 hidden\">Rp 0</td>\n                        <td id=\"total-haul-footer\" class=\"px-4 py-3 text-right text-sm text-yellow-800 hidden\">Rp 0</td>\n                        <td id=\"td-donatur-total-col-2\" class=\"sticky-col-right px-4 py-3 text-right text-sm bg-gray-300 hidden\"></td>\n                    </tr>\n                    <tr class=\"total-row-bold\"> \n                         <td id=\"td-donatur-total-col-3\" colspan=\"5\" class=\"px-4 py-3 text-right text-sm\">**TOTAL KESELURUHAN DONASI:**</td>\n                        <td class=\"px-4 py-3 text-right text-sm bg-green-100 text-green-700\" id=\"total-jariyah-footer\">Rp 0</td>\n                        <td id=\"td-donatur-total-col-4\" colspan=\"4\" class=\"px-4 py-3 text-right text-sm hidden\"></td> \n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n\n        <div id=\"donatur-pagination-container\" class=\"flex justify-center gap-2 py-4 mb-12\">\n            </div>\n\n\n        <div id=\"login-form-container\" class=\"flex flex-wrap justify-center items-center gap-2 py-4 border-t border-b mb-8\"> \n            <input type=\"password\" id=\"admin-password-input\" placeholder=\"Masukkan Password Admin\" class=\"flex-grow max-w-sm border border-gray-300 rounded-md shadow-sm p-2 text-sm\">\n            <button onclick=\"adminLogin()\" class=\"py-2 px-4 bg-blue-600 text-white font-bold rounded hover:bg-blue-700 transition duration-150 text-sm\">\n                Login Admin\n            </button>\n        </div>\n\n        <hr class=\"my-8\">\n        \n        \n        <div id=\"admin-actions-container\" class=\"hidden flex justify-between items-center mt-4 pt-4 border-t\">\n            <button onclick=\"confirmResetData()\" class=\"btn-admin-small bg-yellow-600 text-white font-bold rounded hover:bg-yellow-700 transition duration-150\">\n                Reset Data\n            </button>\n            \n            <button onclick=\"adminLogout()\" class=\"btn-admin-small bg-red-600 text-white font-bold rounded hover:bg-red-900 transition duration-150\">\n                Logout Admin\n            </button>\n        </div>\n\n        <hr class=\"my-8\">\n        \n        \n        <div id=\"jurnal-input-container\" class=\"hidden\">\n            <h2 class=\"text-xl font-semibold mb-4 text-gray-700\">3. Input Jurnal Kas Umum (Dana Keluar)</h2>\n            <form id=\"form-jurnal\" class=\"grid grid-cols-1 md:grid-cols-4 gap-4 bg-gray-50 p-6 rounded-lg border mb-8\">\n                \n                <input type=\"hidden\" id=\"jurnal-id-input\" value=\"\">\n\n                <div><label for=\"tanggal-input-jurnal\" class=\"block text-sm font-medium text-gray-700\">Tanggal</label><input type=\"date\" id=\"tanggal-input-jurnal\" required class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                <div><label for=\"uraian-input\" class=\"block text-sm font-medium text-gray-700\">Uraian / Keterangan</label><input type=\"text\" id=\"uraian-input\" required placeholder=\"Contoh: Pembayaran Konsumsi\" class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                \n                <div>\n                    <label for=\"kategori-input\" class=\"block text-sm font-medium text-gray-700\">Kategori Dana Keluar</label>\n                    <select id=\"kategori-input\" required class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\">\n                        <option value=\"\">Pilih Kategori Pengeluaran</option>\n                        <option value=\"Ongkos Kiai\">1. Ongkos Kiai</option>\n                        <option value=\"Bayar Khataman\">2. Bayar Khataman</option>\n                        <option value=\"Bayar Konsumsi\">3. Bayar Konsumsi</option>\n                        <option value=\"Bayar Persewaan\">4. Bayar Persewaan</option>\n                        <option value=\"Bayar Pekerja\">5. Bayar Pekerja</option>\n                        <option value=\"Lain-lain\">6. Lain-lain</option>\n                    </select>\n                </div>\n\n                <div><label for=\"dana-keluar-input\" class=\"block text-sm font-medium text-gray-700\">Dana Keluar (Rp)</label><input type=\"number\" id=\"dana-keluar-input\" required min=\"1\" placeholder=\"Masukkan jumlah pengeluaran\" class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                \n                <div class=\"col-span-full mt-4 flex gap-4\">\n                    <button type=\"submit\" id=\"jurnal-submit-btn\" class=\"w-full py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150\">\n                        Catat Pengeluaran\n                    </button>\n                    <button type=\"button\" id=\"jurnal-cancel-btn\" class=\"hidden py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition duration-150\" onclick=\"resetJurnalForm()\">\n                        Batal Edit\n                    </button>\n                </div>\n            </form>\n        </div>\n\n        <hr class=\"my-8\">\n\n        \n        <div id=\"donasi-input-container\" class=\"hidden\">\n            <h2 class=\"text-xl font-semibold mb-4 text-gray-700\">4. Input Data Donasi Jariyah</h2>\n            <form id=\"form-donasi\" class=\"grid grid-cols-1 md:grid-cols-4 gap-4 bg-gray-50 p-6 rounded-lg border mb-8\">\n                \n                <input type=\"hidden\" id=\"donatur-id-input\" value=\"\">\n\n                <div class=\"md:col-span-2\"><label for=\"tanggal-input-donasi\" class=\"block text-sm font-medium text-gray-700\">Tanggal</label><input type=\"date\" id=\"tanggal-input-donasi\" required class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                <div class=\"md:col-span-2\"><label for=\"nama-donatur-input\" class=\"block text-sm font-medium text-gray-700\">Nama Donatur</label><input type=\"text\" id=\"nama-donatur-input\" required placeholder=\"Nama lengkap donatur\" class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                <div class=\"md:col-span-2\"><label for=\"alamat-input\" class=\"block text-sm font-medium text-gray-700\">Alamat</label><input type=\"text\" id=\"alamat-input\" required placeholder=\"Alamat donatur\" class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                <div class=\"md:col-span-2\"><label for=\"jariyah-input\" class=\"block text-sm font-medium text-gray-700\">Jariyah (Nominal Rupiah)</label><input type=\"number\" id=\"jariyah-input\" required min=\"1\" placeholder=\"Masukkan jumlah donasi (misal: 100000)\" class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"></div>\n                \n                <div class=\"col-span-full mt-4 flex gap-4\">\n                    <button type=\"submit\" id=\"donasi-submit-btn\" class=\"w-full py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150\">\n                        Catat Donasi\n                    </button>\n                    <button type=\"button\" id=\"donasi-cancel-btn\" class=\"hidden py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition duration-150\" onclick=\"resetDonasiForm()\">\n                        Batal Edit\n                    </button>\n                </div>\n            </form>\n        </div>\n\n    </div>\n\n    <script>\n        const { jsPDF } = window.jspdf;\n        // Data Utama\n        let allTransactions = []; // Data Donatur\n        let jurnalTransactions = []; // Data Jurnal Kas Umum\n        \n        // --- ADMIN CONFIG ---\n        const ADMIN_PASSWORD = 'haul2025'; // GANTI INI DENGAN PASSWORD KAKAK\n        let isAdminLoggedIn = false;\n        \n        // --- PAGINATION CONFIG ---\n        const ITEMS_PER_PAGE = 10;\n        let currentDonaturPage = 1;\n        let currentJurnalPage = 1;\n\n        // --------------------------------------------------------------------------------\n        // HELPER FUNCTIONS\n        // --------------------------------------------------------------------------------\n        \n        const formatRupiah = (angka) => {\n            if (angka === undefined || angka === null || isNaN(angka)) return 'Rp 0';\n            const numberString = Math.abs(angka).toString().replace(/[^,\\d]/g, '');\n            const split = numberString.split(',');\n            const sisa = split[0].length % 3;\n            let rupiah = split[0].substr(0, sisa);\n            const ribuan = split[0].substr(sisa).match(/\\d{3}/gi);\n            \n            if (ribuan) {\n                const separator = sisa ? '.' : '';\n                rupiah += separator + ribuan.join('.');\n            }\n            \n            rupiah = split[1] !== undefined ? rupiah + ',' + split[1] : rupiah;\n            return (angka < 0 ? 'Rp -' : 'Rp ') + rupiah; \n        };\n\n        const loadTransactions = () => {\n            const dataDonatur = localStorage.getItem('donaturHaulData');\n            if (dataDonatur) {\n                allTransactions = JSON.parse(dataDonatur);\n            }\n            const dataJurnal = localStorage.getItem('jurnalHaulData');\n            if (dataJurnal) {\n                jurnalTransactions = JSON.parse(dataJurnal);\n            }\n            \n            // Cek status login dari Session Storage\n            const status = sessionStorage.getItem('isAdminLoggedIn');\n            isAdminLoggedIn = status === 'true'; \n        };\n\n        const saveTransactions = () => {\n            localStorage.setItem('donaturHaulData', JSON.stringify(allTransactions));\n            localStorage.setItem('jurnalHaulData', JSON.stringify(jurnalTransactions));\n        };\n        \n        // --------------------------------------------------------------------------------\n        // PAGINATION LOGIC\n        // --------------------------------------------------------------------------------\n        \n        window.changePage = (tableType, page) => {\n            if (tableType === 'donatur') {\n                currentDonaturPage = page;\n            } else if (tableType === 'jurnal') {\n                currentJurnalPage = page;\n            }\n            renderAllTables();\n        };\n\n        const createPagination = (data, totalItems, containerId, tableType, currentPage, renderCallback) => {\n            const container = document.getElementById(containerId);\n            container.innerHTML = '';\n            \n            if (totalItems <= ITEMS_PER_PAGE) {\n                return;\n            }\n\n            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n            \n            // Tombol \"<<\"\n            const prevBtn = document.createElement('button');\n            prevBtn.textContent = '<<';\n            prevBtn.className = `pagination-btn ${currentPage === 1 ? 'pagination-btn-inactive cursor-not-allowed' : 'bg-yellow-400 hover:bg-yellow-500'}`;\n            prevBtn.disabled = currentPage === 1;\n            prevBtn.onclick = () => { if (currentPage > 1) renderCallback(tableType, currentPage - 1); };\n            container.appendChild(prevBtn);\n\n            // Tampilkan Maksimal 5 Tombol Halaman (dengan ellipsis)\n            let startPage = Math.max(1, currentPage - 2);\n            let endPage = Math.min(totalPages, currentPage + 2);\n\n            if (currentPage < 3) {\n                endPage = Math.min(totalPages, 5);\n                startPage = 1;\n            }\n            if (currentPage > totalPages - 2) {\n                startPage = Math.max(1, totalPages - 4);\n                endPage = totalPages;\n            }\n            \n            if (startPage > 1) {\n                // ... (ellipsis)\n                const ellipsis = document.createElement('span');\n                ellipsis.textContent = '...';\n                ellipsis.className = 'px-2 py-2 text-gray-500';\n                container.appendChild(ellipsis);\n            }\n            \n            for (let i = startPage; i <= endPage; i++) {\n                const btn = document.createElement('button');\n                btn.textContent = i;\n                btn.className = `pagination-btn ${i === currentPage ? 'pagination-btn-active' : 'pagination-btn-inactive'}`;\n                btn.onclick = () => renderCallback(tableType, i);\n                container.appendChild(btn);\n            }\n            \n            if (endPage < totalPages) {\n                 // ... (ellipsis)\n                const ellipsis = document.createElement('span');\n                ellipsis.textContent = '...';\n                ellipsis.className = 'px-2 py-2 text-gray-500';\n                container.appendChild(ellipsis);\n            }\n\n            // Tombol \">>\"\n            const nextBtn = document.createElement('button');\n            nextBtn.textContent = '>>';\n            nextBtn.className = `pagination-btn ${currentPage === totalPages ? 'pagination-btn-inactive cursor-not-allowed' : 'bg-yellow-400 hover:bg-yellow-500'}`;\n            nextBtn.disabled = currentPage === totalPages;\n            nextBtn.onclick = () => { if (currentPage < totalPages) renderCallback(tableType, currentPage + 1); };\n            container.appendChild(nextBtn);\n        };\n        \n        \n        // --------------------------------------------------------------------------------\n        // 1. AUTENTIKASI DAN GLOBAL RENDER CONTROL\n        // --------------------------------------------------------------------------------\n        \n        const updateAdminView = () => {\n            const isLogged = isAdminLoggedIn;\n            \n            // 1. Tampilkan/Sembunyikan Panel Login/Logout\n            document.getElementById('login-form-container').classList.toggle('hidden', isLogged);\n            document.getElementById('admin-actions-container').classList.toggle('hidden', !isLogged);\n            \n            // --- JURNAL KAS UMUM (RAPIH PUBLIK) ---\n            const thJurnalUraian = document.getElementById('th-jurnal-uraian');\n            \n            // Jika TIDAK LOGIN, gabungkan Uraian dan Kategori di header (colspan=2)\n            thJurnalUraian.setAttribute('colspan', isLogged ? '1' : '2');\n            thJurnalUraian.textContent = isLogged ? 'Uraian' : 'Uraian / Keterangan'; // Ubah teks header\n            \n            document.getElementById('th-jurnal-kategori').classList.toggle('hidden', !isLogged);\n            document.getElementById('th-jurnal-aksi').classList.toggle('hidden', !isLogged);\n            \n            // Update colspan total jurnal (Footer)\n            document.getElementById('td-jurnal-total-col').setAttribute('colspan', isLogged ? '3' : '4'); \n            document.getElementById('td-jurnal-total-kategori').classList.toggle('hidden', !isLogged);\n            document.getElementById('td-jurnal-total-aksi').classList.toggle('hidden', !isLogged);\n\n\n            // --- LAPORAN DONATUR (RAPIH PUBLIK) ---\n            document.getElementById('donatur-note-persentase').classList.toggle('hidden', !isLogged);\n            document.getElementById('th-donatur-presentase').classList.toggle('hidden', !isLogged);\n            document.getElementById('donatur-presentase-row').classList.toggle('hidden', !isLogged);\n            document.getElementById('th-donatur-aksi').classList.toggle('hidden', !isLogged);\n            \n            // Update colspan total donatur (Footer)\n            \n            // 1. Baris TOTAL AKUMULASI (Presentase) - Disembunyikan saat publik\n            document.getElementById('total-akumulasi-row').classList.toggle('hidden', !isLogged);\n            document.getElementById('td-donatur-total-col-1').setAttribute('colspan', isLogged ? '6' : '4'); \n            document.getElementById('td-donatur-total-col-2').classList.toggle('hidden', !isLogged); \n            document.getElementById('total-makam-footer').classList.toggle('hidden', !isLogged);\n            document.getElementById('total-panitia-footer').classList.toggle('hidden', !isLogged);\n            document.getElementById('total-haul-footer').classList.toggle('hidden', !isLogged);\n            \n            // 2. Baris TOTAL KESELURUHAN DONASI\n            // Kolom 3 (Teks Total Keseluruhan Donasi) menutupi 5 kolom (NO, Tgl, Nama, Alamat, Jariyah)\n            document.getElementById('td-donatur-total-col-3').setAttribute('colspan', '5'); \n            \n            // Kolom 4 (Kolom kosong sisa presentase dan aksi)\n            // Sembunyikan saat publik agar blok total hanya ada di bawah Total Jariyah (Rp)\n            document.getElementById('td-donatur-total-col-4').classList.toggle('hidden', !isLogged); \n            document.getElementById('td-donatur-total-col-4').setAttribute('colspan', isLogged ? '4' : '0'); \n\n\n            // 3. Tampilkan/Sembunyikan Input Forms\n            document.getElementById('jurnal-input-container').classList.toggle('hidden', !isLogged);\n            document.getElementById('donasi-input-container').classList.toggle('hidden', !isLogged);\n            \n            // Reset halaman ke 1 saat admin view berubah (untuk memastikan tampilan konsisten)\n            currentDonaturPage = 1;\n            currentJurnalPage = 1;\n            \n            // Render ulang tabel untuk menampilkan/menyembunyikan baris/kolom aksi\n            renderAllTables();\n        };\n\n        window.adminLogin = () => {\n            const input = document.getElementById('admin-password-input').value;\n            if (input === ADMIN_PASSWORD) {\n                isAdminLoggedIn = true;\n                sessionStorage.setItem('isAdminLoggedIn', 'true');\n                document.getElementById('admin-password-input').value = '';\n                alert('Login Berhasil! Anda memiliki akses admin.');\n                updateAdminView();\n                // Scroll ke bagian input Jurnal setelah login (untuk admin)\n                window.scrollTo({ top: document.getElementById('jurnal-input-container').offsetTop - 50, behavior: 'smooth' });\n            } else {\n                alert('Password salah. Akses Ditolak.');\n                document.getElementById('admin-password-input').value = '';\n            }\n        };\n\n        window.adminLogout = () => {\n            if (confirm('Anda yakin ingin keluar dari mode Admin?')) {\n                isAdminLoggedIn = false;\n                sessionStorage.removeItem('isAdminLoggedIn');\n                alert('Logout Berhasil. Kembali ke mode Tampilan Publik.');\n                updateAdminView();\n                // Scroll ke tombol login setelah logout\n                window.scrollTo({ top: document.getElementById('login-form-container').offsetTop - 50, behavior: 'smooth' });\n            }\n        };\n        \n        window.confirmResetData = () => {\n            if (!isAdminLoggedIn) return;\n            if (confirm('PERINGATAN! Anda yakin ingin MENGHAPUS SEMUA data Donasi dan Jurnal? Tindakan ini tidak bisa dibatalkan.')) {\n                if (prompt('Untuk konfirmasi, ketik ulang password admin Anda:') === ADMIN_PASSWORD) {\n                    localStorage.removeItem('donaturHaulData');\n                    localStorage.removeItem('jurnalHaulData');\n                    allTransactions = [];\n                    jurnalTransactions = [];\n                    saveTransactions();\n                    renderAllTables();\n                    alert('Semua data berhasil direset (dihapus).');\n                    adminLogout(); // Logout setelah reset\n                } else {\n                    alert('Password konfirmasi salah. Pembatalan reset data.');\n                }\n            }\n        };\n\n        // --------------------------------------------------------------------------------\n        // 2. DONATUR LOGIC (Create, Edit, Delete, & Render)\n        // --------------------------------------------------------------------------------\n\n        const resetDonasiForm = () => {\n            document.getElementById('form-donasi').reset();\n            document.getElementById('donatur-id-input').value = '';\n            document.getElementById('donasi-submit-btn').textContent = 'Catat Donasi';\n            document.getElementById('donasi-submit-btn').classList.replace('bg-green-600', 'bg-blue-600');\n            document.getElementById('donasi-submit-btn').classList.replace('hover:bg-green-700', 'hover:bg-blue-700');\n            document.getElementById('donasi-cancel-btn').classList.add('hidden');\n        };\n\n        document.getElementById('form-donasi').addEventListener('submit', function(e) {\n            e.preventDefault();\n            if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk menginput data.');\n            \n            const id = Date.now().toString(); \n            const tanggal = document.getElementById('tanggal-input-donasi').value;\n            const nama = document.getElementById('nama-donatur-input').value.trim();\n            const alamat = document.getElementById('alamat-input').value.trim();\n            const nilai = parseInt(document.getElementById('jariyah-input').value);\n            \n            if (!tanggal || !nama || !alamat || isNaN(nilai) || nilai <= 0) {\n                 alert('Mohon isi semua kolom donasi dengan benar.');\n                 return;\n            }\n\n            const existingId = document.getElementById('donatur-id-input').value;\n\n            const newTransaction = { \n                id: existingId || id, \n                timestamp: existingId ? allTransactions.find(t => t.id === existingId).timestamp : parseInt(id), \n                tanggal, \n                nama, \n                alamat, \n                nilai \n            };\n\n            if (existingId) {\n                // Mode Edit\n                const index = allTransactions.findIndex(t => t.id === existingId);\n                if (index !== -1) {\n                    allTransactions[index] = newTransaction;\n                    alert('Data Donatur berhasil diubah!');\n                }\n            } else {\n                // Mode Create\n                allTransactions.push(newTransaction);\n                alert('Donasi berhasil dicatat!');\n            }\n            \n            resetDonasiForm();\n            saveTransactions();\n            renderAllTables();\n        });\n\n        window.editDonatur = (id) => {\n            if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk mengedit data.');\n            const transaction = allTransactions.find(t => t.id === id);\n            if (!transaction) return;\n\n            document.getElementById('donatur-id-input').value = transaction.id;\n            document.getElementById('tanggal-input-donasi').value = transaction.tanggal;\n            document.getElementById('nama-donatur-input').value = transaction.nama;\n            document.getElementById('alamat-input').value = transaction.alamat;\n            document.getElementById('jariyah-input').value = transaction.nilai;\n            \n            document.getElementById('donasi-submit-btn').textContent = 'Simpan Perubahan';\n            document.getElementById('donasi-submit-btn').classList.replace('bg-blue-600', 'bg-green-600');\n            document.getElementById('donasi-submit-btn').classList.replace('hover:bg-blue-700', 'hover:bg-green-700');\n            document.getElementById('donasi-cancel-btn').classList.remove('hidden');\n\n            // Scroll ke form input Donasi di bagian bawah\n            window.scrollTo({ top: document.getElementById('donasi-input-container').offsetTop - 50, behavior: 'smooth' });\n        };\n\n        window.deleteDonatur = (id) => {\n             if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk menghapus data.');\n            if (!confirm('Anda yakin ingin menghapus data donatur ini? Menghapus donasi akan mempengaruhi saldo total kas.')) return;\n\n            allTransactions = allTransactions.filter(t => t.id !== id);\n            saveTransactions();\n            renderAllTables();\n            alert('Data Donatur berhasil dihapus.');\n        };\n\n\n        const renderDonaturTable = (data, page = 1) => {\n            const tableBody = document.getElementById('donatur-table-body');\n            tableBody.innerHTML = '';\n            \n            // Urutkan berdasarkan timestamp untuk konsistensi. Data Jurnal akan mengandalkan ini.\n            const sortedData = [...data].sort((a, b) => a.timestamp - b.timestamp);\n            \n            // PAGINATION LOGIC\n            const start = (page - 1) * ITEMS_PER_PAGE;\n            const end = start + ITEMS_PER_PAGE;\n            const dataToDisplay = sortedData.slice(start, end);\n            \n            // Hitung total akumulasi sampai baris terakhir, BUKAN HANYA YANG DITAMPILKAN DI HALAMAN INI\n            let runningTotalJariyah = 0;\n            let totalDanaMasuk = 0;\n            sortedData.forEach(d => totalDanaMasuk += d.nilai);\n\n            // Hitung total akumulasi sampai akhir data, untuk Footer\n            let totalMakamAccumulated = Math.round(totalDanaMasuk * 0.15);\n            let totalPanitiaAccumulated = Math.round(totalDanaMasuk * 0.15);\n            let totalHaulAccumulated = Math.round(totalDanaMasuk * 0.70);\n            \n            const isLogged = isAdminLoggedIn;\n            const colspanPublic = 6; // NO, Tgl, Nama, Alamat, Jariyah, Total Jariyah\n\n            if (sortedData.length === 0) {\n                document.getElementById('total-jariyah-footer').textContent = formatRupiah(0);\n                document.getElementById('total-makam-footer').textContent = formatRupiah(0);\n                document.getElementById('total-panitia-footer').textContent = formatRupiah(0);\n                document.getElementById('total-haul-footer').textContent = formatRupiah(0);\n                tableBody.innerHTML = `<tr><td colspan=\"${isLogged ? 10 : colspanPublic}\" class=\"py-4 text-center text-gray-500\">Belum ada data donasi yang dicatat.</td></tr>`;\n                createPagination(sortedData, sortedData.length, 'donatur-pagination-container', 'donatur', 1, window.changePage);\n                return totalDanaMasuk;\n            }\n            \n            // Hitung kembali runningTotalJariyah HANYA UNTUK DATA YANG DITAMPILKAN DI HALAMAN INI\n            // Cari total akumulasi sebelum halaman ini dimulai\n            let runningTotalBeforePage = 0;\n            for (let i = 0; i < start; i++) {\n                runningTotalBeforePage += sortedData[i].nilai;\n            }\n            runningTotalJariyah = runningTotalBeforePage;\n            \n\n            dataToDisplay.forEach((d, index) => {\n                runningTotalJariyah += d.nilai;\n                \n                // Pembagian Presentase berdasarkan Total Akumulasi Jariyah di baris tersebut\n                const makam = runningTotalJariyah * 0.15; \n                const panitia = runningTotalJariyah * 0.15;\n                const haul = runningTotalJariyah * 0.70;\n                \n                const row = tableBody.insertRow();\n                const date = new Date(d.tanggal);\n                const formattedDate = date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });\n                // Nomor urut harus tetap global, bukan per halaman\n                const displayNo = start + index + 1; \n\n                row.className = index % 2 === 0 ? 'hover:bg-gray-50' : 'bg-gray-50 hover:bg-gray-100';\n                \n                // Kolom 1: NO (Sticky Kiri)\n                const noCell = row.insertCell();\n                noCell.textContent = displayNo; \n                noCell.className = 'sticky-col px-4 py-3 text-center sticky-no-cell text-gray-800 font-normal'; \n\n                row.insertCell().textContent = formattedDate; \n                row.insertCell().textContent = d.nama; \n                row.insertCell().textContent = d.alamat; \n                \n                const nilaiCell = row.insertCell();\n                nilaiCell.textContent = formatRupiah(d.nilai); \n                nilaiCell.className = 'py-3 px-3 text-right text-purple-600 bg-purple-50'; \n                \n                const totalJariyahCell = row.insertCell();\n                totalJariyahCell.textContent = formatRupiah(runningTotalJariyah); \n                totalJariyahCell.className = 'py-3 px-3 text-right text-white bg-green-600';\n                \n                // KOLOM PRESENTASE (HANYA UNTUK ADMIN)\n                if (isLogged) {\n                    row.insertCell().textContent = formatRupiah(Math.round(makam)); \n                    row.insertCell().textContent = formatRupiah(Math.round(panitia)); \n                    row.insertCell().textContent = formatRupiah(Math.round(haul)); \n                }\n                \n                // Kolom AKSI (Sticky Kanan - HANYA UNTUK ADMIN)\n                if (isLogged) {\n                    const actionCell = row.insertCell();\n                    actionCell.className = 'sticky-col-right px-4 py-3 text-center sticky-action-cell';\n                    actionCell.innerHTML = `\n                        <button onclick=\"editDonatur('${d.id}')\" class=\"text-blue-600 hover:text-blue-900 text-sm font-medium mr-2\">Edit</button>\n                        <button onclick=\"deleteDonatur('${d.id}')\" class=\"text-red-600 hover:text-red-900 text-sm font-medium\">Hapus</button>\n                    `;\n                }\n            });\n\n            // Update Footer (Footer selalu menampilkan Total Keseluruhan, BUKAN total per halaman)\n            document.getElementById('total-jariyah-footer').textContent = formatRupiah(totalDanaMasuk);\n            document.getElementById('total-makam-footer').textContent = formatRupiah(totalMakamAccumulated);\n            document.getElementById('total-panitia-footer').textContent = formatRupiah(totalPanitiaAccumulated);\n            document.getElementById('total-haul-footer').textContent = formatRupiah(totalHaulAccumulated);\n            \n            // Buat tombol pagination\n            createPagination(sortedData, sortedData.length, 'donatur-pagination-container', 'donatur', currentDonaturPage, window.changePage);\n\n            return totalDanaMasuk;\n        };\n\n        // --------------------------------------------------------------------------------\n        // 3. JURNAL LOGIC (Create, Edit, Delete, Render)\n        // --------------------------------------------------------------------------------\n\n        const resetJurnalForm = () => {\n            document.getElementById('form-jurnal').reset();\n            document.getElementById('jurnal-id-input').value = '';\n            document.getElementById('jurnal-submit-btn').textContent = 'Catat Pengeluaran';\n            document.getElementById('jurnal-submit-btn').classList.replace('bg-blue-600', 'bg-red-600');\n            document.getElementById('jurnal-submit-btn').classList.replace('hover:bg-red-700', 'hover:bg-blue-700');\n            document.getElementById('jurnal-cancel-btn').classList.add('hidden');\n        };\n\n        document.getElementById('form-jurnal').addEventListener('submit', function(e) {\n            e.preventDefault();\n            if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk menginput data.');\n\n            const id = Date.now().toString();\n            const tanggal = document.getElementById('tanggal-input-jurnal').value;\n            const uraian = document.getElementById('uraian-input').value.trim();\n            const kategori = document.getElementById('kategori-input').value;\n            const danaKeluar = parseInt(document.getElementById('dana-keluar-input').value || 0);\n            \n            if (!tanggal || !uraian || !kategori || danaKeluar <= 0) {\n                 alert('Mohon isi Tanggal, Uraian, Kategori, dan Dana Keluar minimal 1 Rupiah.');\n                 return;\n            }\n            \n            const existingId = document.getElementById('jurnal-id-input').value;\n\n            const newJurnal = { \n                id: existingId || id, \n                timestamp: existingId ? jurnalTransactions.find(t => t.id === existingId).timestamp : parseInt(id), \n                tanggal, \n                uraian, \n                kategori, \n                danaMasuk: 0, \n                danaKeluar \n            };\n\n            if (existingId) {\n                // Mode Edit\n                const index = jurnalTransactions.findIndex(t => t.id === existingId);\n                if (index !== -1) {\n                    jurnalTransactions[index] = newJurnal;\n                    alert('Data Jurnal berhasil diubah!');\n                }\n            } else {\n                // Mode Create\n                jurnalTransactions.push(newJurnal);\n                alert('Pengeluaran berhasil dicatat!');\n            }\n\n            resetJurnalForm();\n            saveTransactions();\n            renderAllTables();\n        });\n        \n        window.editJurnal = (id) => {\n            if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk mengedit data.');\n            const transaction = jurnalTransactions.find(t => t.id === id);\n            if (!transaction) return;\n\n            document.getElementById('jurnal-id-input').value = transaction.id;\n            document.getElementById('tanggal-input-jurnal').value = transaction.tanggal;\n            document.getElementById('uraian-input').value = transaction.uraian;\n            document.getElementById('kategori-input').value = transaction.kategori;\n            document.getElementById('dana-keluar-input').value = transaction.danaKeluar;\n            \n            document.getElementById('jurnal-submit-btn').textContent = 'Simpan Perubahan';\n            document.getElementById('jurnal-submit-btn').classList.replace('bg-red-600', 'bg-blue-600');\n            document.getElementById('jurnal-submit-btn').classList.replace('hover:bg-red-700', 'hover:bg-blue-700');\n            document.getElementById('jurnal-cancel-btn').classList.remove('hidden');\n\n            window.scrollTo({ top: document.getElementById('jurnal-input-container').offsetTop - 50, behavior: 'smooth' });\n        };\n\n        window.deleteJurnal = (id) => {\n            if (!isAdminLoggedIn) return alert('Akses Ditolak. Silakan login sebagai Admin untuk menghapus data.');\n            if (!confirm('Anda yakin ingin menghapus data pengeluaran ini?')) return;\n\n            jurnalTransactions = jurnalTransactions.filter(t => t.id !== id);\n            saveTransactions();\n            renderAllTables();\n            alert('Data Jurnal berhasil dihapus.');\n        };\n\n\n        const renderJurnalTable = (totalDonasi, page = 1) => {\n            const tableBody = document.getElementById('jurnal-table-body');\n            tableBody.innerHTML = '';\n            \n            const donasiEntry = {\n                id: 'DONASI',\n                // Tgl terakhir donasi agar entry ini selalu di awal jurnal\n                timestamp: allTransactions.length > 0 ? new Date(allTransactions[allTransactions.length - 1].tanggal).getTime() - 1 : 0, \n                tanggal: allTransactions.length > 0 ? allTransactions[allTransactions.length - 1].tanggal : new Date().toLocaleDateString('en-CA'), \n                uraian: 'TOTAL AKUMULASI DONASI HAUL',\n                kategori: 'Donatur',\n                danaMasuk: totalDonasi,\n                danaKeluar: 0\n            };\n            \n            // Urutkan data berdasarkan timestamp agar kronologis\n            const combinedData = [donasiEntry, ...jurnalTransactions]\n                .sort((a, b) => a.timestamp - b.timestamp);\n\n            let runningBalance = 0;\n            let totalMasuk = 0;\n            let totalKeluar = 0;\n            const isLogged = isAdminLoggedIn;\n\n            // Hitung total keseluruhan untuk footer\n            combinedData.forEach(t => {\n                totalMasuk += t.danaMasuk;\n                totalKeluar += t.danaKeluar;\n            });\n            const saldoAkhir = totalMasuk - totalKeluar;\n            \n            // Hitung runningBalance sebelum halaman ini dimulai\n            const start = (page - 1) * ITEMS_PER_PAGE;\n            let runningBalanceBeforePage = 0;\n            for (let i = 0; i < start; i++) {\n                runningBalanceBeforePage += combinedData[i].danaMasuk - combinedData[i].danaKeluar;\n            }\n            runningBalance = runningBalanceBeforePage;\n\n\n            // PAGINATION LOGIC\n            const end = start + ITEMS_PER_PAGE;\n            const dataToDisplay = combinedData.slice(start, end);\n\n            if (combinedData.length === 0 || (combinedData.length === 1 && totalDonasi === 0)) {\n                document.getElementById('total-dana-masuk-jurnal').textContent = formatRupiah(0);\n                document.getElementById('total-dana-keluar-jurnal').textContent = formatRupiah(0);\n                document.getElementById('saldo-akhir-jurnal').textContent = formatRupiah(0);\n                // Colspan disesuaikan: 8 (Admin) vs 7 (Publik)\n                tableBody.innerHTML = `<tr><td colspan=\"${isLogged ? 8 : 7}\" class=\"py-4 text-center text-gray-500\">Jurnal Kas Umum belum terisi.</td></tr>`;\n                 createPagination(combinedData, combinedData.length, 'jurnal-pagination-container', 'jurnal', 1, window.changePage);\n                return { totalMasuk: 0, totalKeluar: 0, saldoAkhir: 0 };\n            }\n\n            dataToDisplay.forEach((t, index) => {\n                \n                runningBalance = runningBalance + t.danaMasuk - t.danaKeluar;\n                \n                const row = tableBody.insertRow();\n                const date = new Date(t.tanggal);\n                const formattedDate = t.id === 'DONASI' ? 'Tgl. Terakhir Donasi' : date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });\n                \n                row.className = index % 2 === 0 ? 'hover:bg-gray-50' : 'bg-gray-50 hover:bg-gray-100';\n                \n                // 1. NO\n                const noCell = row.insertCell();\n                const globalIndex = start + index;\n                noCell.textContent = t.id === 'DONASI' ? '' : globalIndex; \n                if (t.id !== 'DONASI') {\n                    noCell.textContent = globalIndex;\n                }\n                noCell.className = 'sticky-col px-4 py-3 text-center sticky-no-cell text-gray-800 bg-gray-100 font-normal'; \n                \n                // 2. Tanggal\n                row.insertCell().textContent = formattedDate;\n                \n                // 3. Uraian\n                const uraianCell = row.insertCell();\n                // Gabungkan uraian dan kategori saat mode publik\n                uraianCell.textContent = isLogged ? t.uraian : `${t.uraian} (${t.kategori})`;\n                // Atur colspan=2 jika mode publik\n                if (!isLogged) {\n                    uraianCell.setAttribute('colspan', '2');\n                }\n                \n                // 4. Kategori (HANYA UNTUK ADMIN)\n                if (isLogged) {\n                    row.insertCell().textContent = t.kategori; \n                }\n                \n                // 5. Dana Masuk\n                const masukCell = row.insertCell();\n                masukCell.textContent = formatRupiah(t.danaMasuk);\n                masukCell.className = 'py-3 px-3 text-right text-green-700'; \n\n                // 6. Dana Keluar\n                const keluarCell = row.insertCell();\n                keluarCell.textContent = formatRupiah(t.danaKeluar);\n                keluarCell.className = 'py-3 px-3 text-right text-red-700';\n                \n                // 7. Saldo\n                const saldoCell = row.insertCell();\n                saldoCell.textContent = formatRupiah(runningBalance);\n                saldoCell.className = 'py-3 px-3 text-right';\n\n                // 8. Aksi (Sticky Kanan - HANYA UNTUK ADMIN)\n                if (isLogged) {\n                    const actionCell = row.insertCell();\n                    actionCell.className = 'sticky-col-right px-4 py-3 text-center sticky-action-cell';\n                    if (t.id !== 'DONASI') {\n                        actionCell.innerHTML = `\n                            <button onclick=\"editJurnal('${t.id}')\" class=\"text-blue-600 hover:text-blue-900 text-sm font-medium mr-2\">Edit</button>\n                            <button onclick=\"deleteJurnal('${t.id}')\" class=\"text-red-600 hover:text-red-900 text-sm font-medium\">Hapus</button>\n                        `;\n                    } else {\n                        actionCell.textContent = '-';\n                    }\n                }\n            });\n\n            // Update Footer (Footer selalu menampilkan Total Keseluruhan)\n            document.getElementById('total-dana-masuk-jurnal').textContent = formatRupiah(totalMasuk);\n            document.getElementById('total-dana-keluar-jurnal').textContent = formatRupiah(totalKeluar);\n            document.getElementById('saldo-akhir-jurnal').textContent = formatRupiah(saldoAkhir);\n            \n            // Buat tombol pagination\n            createPagination(combinedData, combinedData.length, 'jurnal-pagination-container', 'jurnal', currentJurnalPage, window.changePage);\n\n\n            return { totalMasuk, totalKeluar, saldoAkhir: saldoAkhir };\n        };\n\n        // --------------------------------------------------------------------------------\n        // 4. PDF EXPORT FUNCTIONS (Kolom Admin Disembunyikan Otomatis di PDF)\n        // --------------------------------------------------------------------------------\n        \n        // FUNGSI TANDA TANGAN DENGAN PERATAAN CENTER\n        const addSignatures = (doc, yPos) => {\n            doc.setFontSize(10);\n            // Mengatur font untuk PDF agar seragam\n            doc.setFont('times', 'normal'); \n            const pageWidth = doc.internal.pageSize.getWidth();\n            const margin = 15;\n            const columnSpacing = (pageWidth - 2 * margin) / 3; \n            const col1X = margin + columnSpacing / 2; \n            const col2X = margin + columnSpacing + columnSpacing / 2; \n            const col3X = margin + 2 * columnSpacing + columnSpacing / 2; \n\n            // Teks Pati, Tgl (di kanan)\n            doc.text(\"Pati, \" + new Date().toLocaleDateString('id-ID', {day: '2-digit', month: 'long', year: 'numeric'}), pageWidth - margin, yPos + 10, { align: 'right' });\n            \n            yPos += 30; \n            \n            // Teks Jabatan (Center di masing-masing kolom)\n            doc.text(\"Mengetahui,\", col1X, yPos, { align: 'center' });\n            doc.text(\"Ketua Panitia Haul\", col1X, yPos + 5, { align: 'center' });\n\n            doc.text(\"Bendahara Haul\", col2X, yPos + 5, { align: 'center' });\n\n            doc.text(\"Sekretaris\", col3X, yPos + 5, { align: 'center' });\n            \n            yPos += 40;\n            \n            // Garis Tanda Tangan (Center di masing-masing kolom)\n            doc.text(\"(.........................................)\", col1X, yPos, { align: 'center' });\n            doc.text(\"(.........................................)\", col2X, yPos, { align: 'center' });\n            doc.text(\"(.........................................)\", col3X, yPos, { align: 'center' });\n        };\n        \n        const setupPDF = (title) => {\n             const doc = new jsPDF('p', 'mm', 'a4');\n             doc.setFont('times', 'normal'); // Mengatur font default Times/Cambria di PDF\n             doc.setFontSize(16);\n             doc.text(\"LPJ Keuangan Haul\", 105, 15, { align: 'center' });\n             doc.setFontSize(12);\n             doc.text(title, 105, 22, { align: 'center' });\n             return doc;\n        }\n\n        // --- EXPORT 1: Donatur List (Hanya Kolom Umum yang Terpakai) ---\n        const exportDonaturPDF = () => {\n            const doc = setupPDF(\"Laporan List Donatur Jariyah\");\n            const data = [...allTransactions].sort((a, b) => a.timestamp - b.timestamp);\n            \n            let runningTotalJariyah = 0;\n            const tableBody = [];\n            \n            // Kolom Presentase tidak dimasukkan ke dalam PDF Donatur List\n            const header = [['NO', 'Tanggal', 'Nama Donatur', 'Alamat', 'Jariyah (Rp)', 'Total Jariyah (Rp)']];\n\n            data.forEach((d, index) => {\n                runningTotalJariyah += d.nilai;\n                const formattedDate = new Date(d.tanggal).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });\n                \n                tableBody.push([\n                    index + 1,\n                    formattedDate,\n                    d.nama,\n                    d.alamat,\n                    formatRupiah(d.nilai),\n                    formatRupiah(runningTotalJariyah)\n                ]);\n            });\n\n            // Footer hanya TOTAL KESELURUHAN DONASI (DIBUAT BOLD DI SINI)\n            tableBody.push([\n                { content: 'TOTAL KESELURUHAN DONASI:', colSpan: 4, styles: { fillColor: [209, 213, 219], fontStyle: 'bold', halign: 'right' } },\n                { content: formatRupiah(runningTotalJariyah), colSpan: 2, styles: { fillColor: [178, 245, 178], fontStyle: 'bold', halign: 'right' } }\n            ]);\n            \n            doc.autoTable({\n                head: header,\n                body: tableBody,\n                startY: 30,\n                theme: 'striped',\n                headStyles: { \n                    fillColor: [107, 70, 193],\n                    columnStyles: {\n                        4: { halign: 'right' },\n                        5: { halign: 'right' }\n                    }\n                }, \n                columnStyles: {\n                    4: { halign: 'right' },\n                    5: { halign: 'right' }\n                }\n            });\n            \n            addSignatures(doc, doc.lastAutoTable.finalY + 10);\n            doc.save(\"LPJ_Donatur_List.pdf\");\n        };\n\n        // --- EXPORT 2: Jurnal Detail (Kategori DITAMPILKAN di PDF untuk verifikasi) ---\n        const exportJurnalDetailPDF = () => {\n             const doc = setupPDF(\"Laporan Detail Jurnal Kas Umum\");\n             \n             // Hitung total donasi (Running Donatur tidak perlu di sini)\n             const totalDonasi = allTransactions.reduce((sum, t) => sum + t.nilai, 0); \n             \n             // Logika pembuatan data Jurnal untuk PDF (mirip dengan renderJurnalTable)\n             const donasiEntry = {\n                id: 'DONASI',\n                timestamp: allTransactions.length > 0 ? new Date(allTransactions[allTransactions.length - 1].tanggal).getTime() - 1 : 0, \n                tanggal: allTransactions.length > 0 ? allTransactions[allTransactions.length - 1].tanggal : new Date().toLocaleDateString('en-CA'), \n                uraian: 'TOTAL AKUMULASI DONASI HAUL',\n                kategori: 'Donatur', \n                danaMasuk: totalDonasi,\n                danaKeluar: 0\n            };\n            \n            const combinedData = [donasiEntry, ...jurnalTransactions].sort((a, b) => a.timestamp - b.timestamp);\n            \n            let runningBalance = 0;\n            let totalMasuk = 0;\n            let totalKeluar = 0;\n            let currentIndex = 0;\n            const tableBody = [];\n            const header = [['NO', 'Tanggal', 'Uraian', 'Kategori', 'Dana Masuk (Rp)', 'Dana Keluar (Rp)', 'Saldo (Rp)']];\n\n            combinedData.forEach((t) => {\n                \n                runningBalance = runningBalance + t.danaMasuk - t.danaKeluar;\n                totalMasuk += t.danaMasuk;\n                totalKeluar += t.danaKeluar;\n                \n                if (t.id !== 'DONASI') {\n                    currentIndex++;\n                }\n\n                const formattedDate = t.id === 'DONASI' ? 'Tgl. Terakhir Donasi' : new Date(t.tanggal).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });\n                const displayNo = t.id === 'DONASI' ? '' : currentIndex;\n\n                tableBody.push([\n                    displayNo,\n                    formattedDate,\n                    t.uraian,\n                    t.kategori, \n                    formatRupiah(t.danaMasuk),\n                    formatRupiah(t.danaKeluar),\n                    formatRupiah(runningBalance)\n                ]);\n            });\n\n             // Tambahkan Footer Saldo Akhir (DIBUAT BOLD DI SINI)\n            tableBody.push([\n                { content: 'TOTAL AKUMULASI KAS:', colSpan: 4, styles: { fontStyle: 'bold', fillColor: [209, 213, 219], halign: 'right' } },\n                { content: formatRupiah(totalMasuk), styles: { fontStyle: 'bold', halign: 'right', fillColor: [178, 245, 178], fontSize: 9 } }, \n                { content: formatRupiah(totalKeluar), styles: { fontStyle: 'bold', halign: 'right', fillColor: [255, 192, 203], fontSize: 9 } }, \n                { content: formatRupiah(runningBalance), styles: { fontStyle: 'bold', halign: 'right', fillColor: [173, 216, 230], fontSize: 9 } }, \n            ]);\n\n\n             doc.autoTable({\n                head: header,\n                body: tableBody,\n                startY: 30,\n                theme: 'striped',\n                headStyles: { \n                    fillColor: [5, 150, 105], \n                    fontSize: 9,\n                    columnStyles: {\n                        4: { halign: 'right' },\n                        5: { halign: 'right' },\n                        6: { halign: 'right' }\n                    }\n                }, \n                bodyStyles: { fontSize: 8 }, \n                columnStyles: {\n                    4: { halign: 'right', minCellWidth: 25 }, \n                    5: { halign: 'right', minCellWidth: 25 }, \n                    6: { halign: 'right', minCellWidth: 25 }  \n                },\n                didParseCell: (data) => {\n                    if (data.row.index < tableBody.length - 1) { \n                        if (data.column.index >= 4 && data.column.index <= 6) {\n                            data.cell.styles.halign = 'right';\n                            data.cell.styles.fontSize = 9; \n                        }\n                    }\n                }\n             });\n             \n             addSignatures(doc, doc.lastAutoTable.finalY + 10);\n             doc.save(\"LPJ_Jurnal_Detail.pdf\");\n        };\n\n        // --- EXPORT 3: LPJ Global (Ringkasan Per Kategori) ---\n        const exportLpjGlobalPDF = () => {\n            const doc = setupPDF(\"Laporan Global LPJ (Ringkasan Per Kategori)\");\n            \n            // ... (Kode perhitungan total tetap sama) ...\n            \n            const totalDonasi = allTransactions.reduce((sum, t) => sum + t.nilai, 0); \n            const totalMasuk = totalDonasi;\n            const totalKeluar = jurnalTransactions.reduce((sum, t) => sum + t.danaKeluar, 0);\n            const saldoAkhir = totalMasuk - totalKeluar;\n            \n            const jurnalSummary = jurnalTransactions.reduce((acc, t) => {\n                acc[t.kategori] = (acc[t.kategori] || 0) + t.danaKeluar;\n                return acc;\n            }, {});\n\n            const tableBody = [];\n            const header = [['URAIAN', 'JUMLAH (Rp)']]; \n\n            // DANA MASUK\n            tableBody.push([{ content: 'DANA MASUK', colSpan: 2, styles: { fontStyle: 'bold', fillColor: [178, 245, 178] } }]);\n            tableBody.push(['Donatur (Total Donasi)', { content: formatRupiah(totalDonasi || 0), styles: { halign: 'right' } }]);\n            // TOTAL DANA MASUK\n            tableBody.push([{ content: 'TOTAL DANA MASUK', colSpan: 1, styles: { fontStyle: 'bold', fillColor: [144, 238, 144] } }, { content: formatRupiah(totalMasuk || 0), styles: { fontStyle: 'bold', halign: 'right', fillColor: [144, 238, 144] } }]);\n            \n            // DANA KELUAR\n            tableBody.push([{ content: 'DANA KELUAR', colSpan: 2, styles: { fontStyle: 'bold', fillColor: [255, 192, 203] } }]);\n            \n            const categories = [\n                { name: 'Ongkos Kiai', key: 'Ongkos Kiai' },\n                { name: 'Bayar Khataman', key: 'Bayar Khataman' },\n                { name: 'Bayar Konsumsi', key: 'Bayar Konsumsi' },\n                { name: 'Bayar Persewaan', key: 'Bayar Persewaan' },\n                { name: 'Bayar Pekerja', key: 'Bayar Pekerja' },\n                { name: 'Lain-lain', key: 'Lain-lain' }\n            ];\n\n            categories.forEach(cat => {\n                const amount = jurnalSummary[cat.key] || 0;\n                if (amount > 0) {\n                    tableBody.push([cat.name, { content: formatRupiah(amount), styles: { halign: 'right' } }]);\n                }\n            });\n\n            // TOTAL DANA KELUAR\n            tableBody.push([{ content: 'TOTAL DANA KELUAR', colSpan: 1, styles: { fontStyle: 'bold', fillColor: [255, 182, 193] } }, { content: formatRupiah(totalKeluar || 0), styles: { fontStyle: 'bold', halign: 'right', fillColor: [255, 182, 193] } }]);\n\n            // SALDO AKHIR\n            tableBody.push([{ content: 'SALDO AKHIR', colSpan: 1, styles: { fontStyle: 'bold', fillColor: [173, 216, 230] } }, { content: formatRupiah(saldoAkhir || 0), styles: { fontStyle: 'bold', halign: 'right', fillColor: [255, 255, 153] } }]);\n            \n            doc.autoTable({\n                head: header,\n                body: tableBody,\n                startY: 30,\n                theme: 'striped',\n                headStyles: { \n                    fillColor: [107, 70, 193],\n                    fontSize: 9.5,\n                    // Header (JUMLAH (Rp)) digeser 0.5mm ke kiri agar sejajar dengan angka di body\n                    cellPadding: [2, 0.5, 2, 4], \n                    cellStyles: { \n                        1: { halign: 'right' } \n                    },\n                },\n                columnStyles: {\n                    0: { columnWidth: 'wrap', cellPadding: [2, 4, 2, 4] }, \n                    1: { \n                        halign: 'right', \n                        columnWidth: 40,\n                        // Body (Angka Rupiah) menempel nol ke batas kanan\n                        cellPadding: [2, 0, 2, 4] \n                    } \n                }\n            });\n            \n            addSignatures(doc, doc.lastAutoTable.finalY + 10);\n            doc.save(\"LPJ_Global_Ringkasan.pdf\");\n        };\n\n\n        // --------------------------------------------------------------------------------\n        // 5. RENDER ALL\n        // --------------------------------------------------------------------------------\n\n        const renderAllTables = () => {\n            // Urutkan donatur sebelum merender\n            allTransactions.sort((a, b) => a.timestamp - b.timestamp);\n            const totalDonasi = renderDonaturTable(allTransactions, currentDonaturPage);\n            renderJurnalTable(totalDonasi, currentJurnalPage);\n        };\n\n        window.onload = () => {\n            loadTransactions();\n            updateAdminView(); // Panggil ini untuk menyesuaikan tampilan saat load pertama\n            renderAllTables();\n        };\n    </script>\n\n</body>\n</html>"
  }
]
