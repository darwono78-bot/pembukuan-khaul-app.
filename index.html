<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembukuan Dana Khaul</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // TEMPATKAN SEMUA KODE JAVASCRIPT/FIREBASE DI BAGIAN BAWAH INI
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .container-app {
            max-width: 1100px; /* Lebar lebih besar untuk tabel 8 kolom */
        }
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150;
        }
        .header-title {
            @apply text-3xl font-bold text-center text-gray-800 mb-6;
        }
        .section-title {
            @apply text-xl font-semibold text-gray-700 border-b pb-2 mb-4 mt-8;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md hover:shadow-lg w-full;
        }
        /* Style untuk modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Sembunyikan secara default */
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
        }
        /* Tambahan: Prosentase hanya terlihat saat Admin Login */
        .admin-only-col {
            display: none;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container-app mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
        
        <h1 class="header-title bg-green-600 text-white p-4 rounded-lg shadow-inner">
            Aplikasi Pembukuan Dana Khaul
        </h1>
        
        <div class="mt-4 p-3 bg-gray-100 rounded-lg text-sm border-l-4 border-blue-500">
            <p id="login-status" class="font-semibold text-gray-700">Memuat status autentikasi...</p>
            <p id="user-id-display" class="text-gray-500 break-all">Admin ID:</p>
        </div>

        <div id="message-container" class="mt-4">
            </div>

        <div class="section-title border-green-500">
            1. Catat Dana Masuk (Donasi Jariyah)
        </div>
        <div class="space-y-4">
            
            <input type="text" id="donatur-nama" placeholder="Nama Donatur (Kolom 3)" class="input-field">
            
            <input type="text" id="donatur-alamat" placeholder="Alamat (Kolom 4)" class="input-field">

            <input type="text" id="tanggal-input-masuk" placeholder="Tanggal Transaksi (Klik untuk pilih)" class="input-field" value="" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
            
            <input type="text" id="keterangan-donasi" placeholder="Keterangan Donasi (Kolom 5 - Jariyah)" class="input-field">
            
            <div class="relative">
                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">Rp</span>
                <input type="number" id="jumlah-input-masuk" placeholder="Total Jariyah (Kolom 6 - Angka saja)" class="input-field pl-10">
            </div>
            
            <button onclick="window.catatDonasi()" class="btn-primary bg-green-600 hover:bg-green-700">
                Catat Donasi Jariyah
            </button>
        </div>

        <div class="section-title border-red-500">
            2. Catat Dana Keluar (Transaksi Umum)
        </div>
        <div class="space-y-4">
            <input type="text" id="tanggal-input-keluar" placeholder="Tanggal Transaksi (Klik untuk pilih)" class="input-field" value="" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
            
            <select id="kategori-select-keluar" class="input-field">
                 <option value="">-- Pilih Kategori --</option>
                </select>
            
            <input type="text" id="uraian-input-keluar" placeholder="Uraian Pengeluaran" class="input-field">
            
            <div class="relative">
                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">Rp</span>
                <input type="number" id="jumlah-input-keluar" placeholder="Jumlah Dana Keluar (Angka saja)" class="input-field pl-10">
            </div>
            
            <button onclick="window.catatPengeluaran()" class="btn-primary bg-red-600 hover:bg-red-700">
                Catat Pengeluaran
            </button>
        </div>
        
        <div class="section-title border-blue-500">
            3. Dashboard Laporan Kas Berjalan (Jurnal Umum)
        </div>
        
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mb-4">
            <input type="text" id="search-input" placeholder="Cari Uraian atau Kategori..." class="input-field sm:w-1/2">
            <select id="filter-kategori" class="input-field sm:w-1/4">
                <option value="">Filter Kategori...</option>
                </select>
            <select id="sort-by" class="input-field sm:w-1/4">
                <option value="tanggal_desc">Urutkan: Terbaru</option>
                <option value="tanggal_asc">Urutkan: Terlama</option>
            </select>
        </div>

        <div class="overflow-x-auto rounded-lg shadow-lg">
            <table class="min-w-full bg-white border border-gray-200">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-3 text-center">No</th>
                        <th class="py-3 px-3 text-center">Tanggal</th>
                        <th class="py-3 px-3 text-left">Uraian / Donatur</th>
                        <th class="py-3 px-3 text-left admin-only-col" id="header-kategori">Kategori</th>
                        <th class="py-3 px-3 text-right">Dana Masuk</th>
                        <th class="py-3 px-3 text-right">Dana Keluar</th>
                        <th class="py-3 px-3 text-right">Saldo</th>
                        <th class="py-3 px-3 text-center admin-only-col" id="header-aksi">Aksi</th>
                    </tr>
                </thead>
                <tbody id="laporan-table-body" class="text-gray-600 text-sm font-light divide-y divide-gray-200">
                    <tr>
                        <td colspan="8" class="py-4 text-center text-gray-500">Memuat data...</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="bg-green-50 font-bold text-gray-800">
                        <td colspan="4" class="py-3 px-6 text-right admin-only-col"></td>
                        <td colspan="3" class="py-3 px-6 text-right">TOTAL SALDO AKHIR:</td>
                        <td id="total-masuk" class="py-3 px-6 text-right">Rp 0</td>
                        <td id="total-keluar" class="py-3 px-6 text-right">Rp 0</td>
                        <td id="saldo-akhir" class="py-3 px-6 text-right text-lg text-green-700">Rp 0</td>
                        <td class="py-3 px-6 text-center admin-only-col"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="mt-6 flex flex-wrap gap-4 justify-center">
            <button onclick="window.generatePDF('donatur')" class="btn-primary bg-blue-600 hover:bg-blue-700 w-full sm:w-auto flex-1">
                Unduh List Donatur (PDF)
            </button>
            <button onclick="window.generatePDF('pengeluaran')" class="btn-primary bg-yellow-600 hover:bg-yellow-700 w-full sm:w-auto flex-1">
                Unduh Pengeluaran Detail (PDF)
            </button>
            <button onclick="window.generatePDF('lpj')" class="btn-primary bg-green-600 hover:bg-green-700 w-full sm:w-auto flex-1">
                Unduh Laporan Pertanggung Jawaban (LPJ - PDF)
            </button>
        </div>

    </div> <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-bold text-red-600 mb-4">Konfirmasi Hapus</h3>
            <p id="modal-message" class="text-gray-700 mb-6">Apakah Anda yakin ingin menghapus transaksi ini?</p>
            <div class="flex justify-end space-x-4">
                <button onclick="document.getElementById('confirm-modal').style.display='none'" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100 transition duration-150">Batal</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition duration-150">Hapus Permanen</button>
            </div>
        </div>
    </div>
    
</body>
</html>
